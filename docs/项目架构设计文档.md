# DBCLI 项目架构设计文档

## 📋 项目概述

DBCLI是一个企业级多数据库指标收集与报告工具，支持Oracle、MySQL、PostgreSQL、达梦数据库。采用现代化Java架构设计，具备高性能、高可用、高安全性特征。

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    DBCLI 系统架构                            │
├─────────────────────────────────────────────────────────────┤
│  Web管理层 (Web Management Layer)                           │
│  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  Web控制台      │  │  RESTful API    │                  │
│  │  (8080端口)     │  │  (/api/*)       │                  │
│  └─────────────────┘  └─────────────────┘                  │
├─────────────────────────────────────────────────────────────┤
│  应用服务层 (Application Service Layer)                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  DbCliRunner    │  │  配置热重载     │  │  监控服务   │ │
│  │  (核心调度器)   │  │  HotReload      │  │  Monitor    │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  业务逻辑层 (Business Logic Layer)                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  指标执行器     │  │  报告生成器     │  │  配置管理   │ │
│  │  MetricsExecutor│  │  ReportGenerator│  │  ConfigMgr  │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  数据访问层 (Data Access Layer)                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  连接工厂       │  │  查询执行器     │  │  连接池管理 │ │
│  │  ConnectionFact │  │  QueryExecutor  │  │  HikariCP   │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────────────┤
│  基础设施层 (Infrastructure Layer)                          │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  日志系统       │  │  加密服务       │  │  工具类     │ │
│  │  SLF4J+Logback  │  │  SM4 Encryption │  │  Utils      │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 🧩 核心模块设计

### 模块结构
```
com.dbcli/
├── cli/                    # 命令行处理
├── config/                 # 配置管理
├── core/                   # 核心业务
├── database/               # 数据库访问
├── executor/               # 执行器
├── model/                  # 数据模型
├── service/                # 业务服务
├── util/                   # 工具类
└── web/                    # Web管理
```

### 核心组件说明

#### 1. Web管理层
- **WebManagementServer**: 内置HTTP服务器，提供Web管理界面
- **RESTful API**: 标准REST接口，支持系统状态查询、配置管理等

#### 2. 应用服务层
- **DbCliRunner**: 核心调度器，负责整个应用的生命周期管理
- **HotReloadConfigManager**: 配置热重载管理器，监控配置文件变化

#### 3. 业务逻辑层
- **ConcurrentMetricsExecutor**: 并发指标执行器，支持多线程并发执行
- **ReportGenerator**: 报告生成器，支持Excel和HTML格式

## 🔧 技术栈

### 核心技术
- **Java 8**: 基础运行环境
- **Maven**: 项目构建和依赖管理
- **SLF4J + Logback**: 日志框架
- **HikariCP**: 高性能连接池
- **SnakeYAML**: YAML配置解析

### 数据库驱动
- **Oracle**: ojdbc8
- **MySQL**: mysql-connector-java
- **PostgreSQL**: postgresql
- **达梦**: dm8-jdbc

## 🚀 性能设计

### 并发模型
- **线程池**: 自适应线程池，根据负载动态调整
- **连接池**: HikariCP高性能连接池，支持连接复用
- **异步执行**: CompletableFuture异步编程模型

### 内存管理
- **对象池**: 重用对象，减少GC压力
- **流式处理**: 大数据量场景下的流式处理
- **缓存策略**: 配置缓存，避免重复解析

---

**文档版本**: v1.0  
**更新时间**: 2025年9月5日